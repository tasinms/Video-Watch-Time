<!DOCTYPE html>
<html>

<head>
    <title>Video Page</title>]
    
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        .video-container {
            width: 80%;
            max-width: 900px;
        }
    </style>
</head>

<body>
    <div class="video-container">
        <div style="padding:56.21% 0 0 0;position:relative;">
            <iframe id="vimeo-player"
                src="https://player.vimeo.com/video/929201355?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479&amp;autoplay=1"
                frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write"
                style="position:absolute;top:0;left:0;width:100%;height:100%;"
                title="Beerus Being Scared of Zeno For a Solid 7 Minutes">
            </iframe>
        </div>

        <script src="https://player.vimeo.com/api/player.js"></script>


        <!-- Add parameters to the URL -->
        <script>
            // Get the current URL
            var currentURL = window.location.href;

            // Check if the URL already has the email parameter
            if (!currentURL.includes('?email=abid%40technosway.com')) {
                // Append the email parameter to the URL
                currentURL += '?email=abid%40technosway.com';

                // Redirect to the modified URL
                window.location.href = currentURL;
            }
        </script>

        <script>
            // Retrieve email and full name from URL parameters
            var urlParams = new URLSearchParams(window.location.search);
            var email = urlParams.get("email");

            var iframe = document.querySelector("#vimeo-player");
            var player = new Vimeo.Player(iframe);
            var maxWatchedTime = 0;

            player.on("timeupdate", function (data) {
                if (data.seconds > maxWatchedTime) {
                    maxWatchedTime = data.seconds;
                }
                var minutes = Math.floor(maxWatchedTime / 60);
                var seconds = Math.floor(maxWatchedTime % 60);

                console.log(
                    "Email: " +
                    email +
                    "\nWatch Time: " +
                    minutes +
                    " minutes " +
                    seconds +
                    " seconds"
                );
            });

            window.onbeforeunload = function () {
                return "";
            };

            window.addEventListener("beforeunload", (event) => {
                const zapierWebhookUrl =
                    "https://hooks.zapier.com/hooks/catch/18433711/3pd7xfj/";

                var watchTime =
                    Math.floor(maxWatchedTime / 60) +
                    " minutes " +
                    Math.floor(maxWatchedTime % 60) +
                    " seconds";

                // Data to be sent in the POST request
                const postData = {
                    contact: {
                        email: email,
                        watchTime: watchTime,
                    },
                };

                // Configuring the fetch request
                const requestOptions = {
                    method: "POST",
                    body: JSON.stringify(postData),
                };

                // Sending the POST request
                fetch(zapierWebhookUrl, requestOptions)
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error("Network response was not ok");
                        }
                        return response.json();
                    })
                    .then((data) => {
                        console.log("Success:", data);
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                    });
            });

        </script>

    </div>
</body>

</html>